<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roboflow Automation — Dashboard</title>
    <style>
        /* ── Reset & Base ─────────────────────────────────────── */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f1117;
            color: #e0e0e0;
            line-height: 1.5;
            padding: 1rem 2rem;
        }
        a { color: #58a6ff; text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* ── Header ───────────────────────────────────────────── */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .header h1 { font-size: 1.4rem; color: #f0f6fc; }
        .header-right { display: flex; align-items: center; gap: 1.25rem; }
        .header .uptime { color: #8b949e; font-size: 0.85rem; }
        .version-badge {
            background: #1f6feb;
            color: #fff;
            font-size: 0.72rem;
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            letter-spacing: 0.03em;
        }

        /* ── Grid Layout ──────────────────────────────────────── */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.25rem; margin-bottom: 1.5rem; }
        .grid-full { grid-column: 1 / -1; }

        /* ── Cards ────────────────────────────────────────────── */
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem 1.25rem;
        }
        .card h2 {
            font-size: 0.85rem;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #21262d;
            padding-bottom: 0.4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card h2 .badge-sm {
            font-size: 0.65rem;
            background: #21262d;
            color: #8b949e;
            padding: 0.1rem 0.45rem;
            border-radius: 8px;
            font-weight: 400;
            text-transform: none;
            letter-spacing: 0;
        }

        /* ── Stat Cards Row ───────────────────────────────────── */
        .stat-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem 1.25rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
        }
        .stat-card.held::before { background: #f0883e; }
        .stat-card.done::before { background: #3fb950; }
        .stat-card.failed::before { background: #f85149; }
        .stat-card.total::before { background: #58a6ff; }
        .stat-card .value {
            font-size: 2.2rem;
            font-weight: 700;
            line-height: 1.1;
        }
        .stat-card .label {
            font-size: 0.72rem;
            color: #8b949e;
            text-transform: uppercase;
            margin-top: 0.25rem;
        }
        .stat-card.held .value { color: #f0883e; }
        .stat-card.done .value { color: #3fb950; }
        .stat-card.failed .value { color: #f85149; }
        .stat-card.total .value { color: #58a6ff; }

        /* ── Actions Row ─────────────────────────────────────── */
        .actions-row {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .actions-label {
            font-size: 0.7rem;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .btn-action {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.85rem;
            font-size: 0.78rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid;
            background: transparent;
            transition: background 0.15s, opacity 0.15s;
        }
        .btn-action:active { opacity: 0.75; }
        .btn-action.danger  { color: #f85149; border-color: #f85149; }
        .btn-action.danger:hover { background: rgba(248,81,73,0.12); }

        /* ── Progress Bar ─────────────────────────────────────── */
        .progress-section { margin-bottom: 1.5rem; }
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .progress-header .pct {
            font-size: 1.1rem;
            font-weight: 700;
            color: #3fb950;
        }
        .progress-header .label {
            font-size: 0.8rem;
            color: #8b949e;
        }
        .progress-bar-outer {
            background: #21262d;
            border-radius: 6px;
            height: 12px;
            overflow: hidden;
            display: flex;
        }
        .progress-bar-done {
            background: #3fb950;
            height: 100%;
            transition: width 0.6s ease;
        }
        .progress-bar-held {
            background: #f0883e;
            height: 100%;
            transition: width 0.6s ease;
        }
        .progress-bar-failed {
            background: #f85149;
            height: 100%;
            transition: width 0.6s ease;
        }
        .progress-legend {
            display: flex;
            gap: 1.25rem;
            margin-top: 0.4rem;
            font-size: 0.72rem;
            color: #8b949e;
        }
        .progress-legend span::before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 2px;
            margin-right: 0.3rem;
            vertical-align: middle;
        }
        .progress-legend .leg-done::before { background: #3fb950; }
        .progress-legend .leg-held::before { background: #f0883e; }
        .progress-legend .leg-failed::before { background: #f85149; }

        /* ── Worker Cards ─────────────────────────────────────── */
        .worker-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 0.75rem; }
        .worker-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 0.85rem 1rem;
            position: relative;
        }
        .worker-card-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.6rem;
        }
        .worker-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
        }
        .worker-dot.online  { background: #3fb950; box-shadow: 0 0 6px rgba(63,185,80,0.4); }
        .worker-dot.stale   { background: #d29922; box-shadow: 0 0 6px rgba(210,153,34,0.3); }
        .worker-dot.offline { background: #f85149; box-shadow: 0 0 6px rgba(248,81,73,0.3); }
        .worker-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #f0f6fc;
        }
        .worker-conn-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            margin-left: auto;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
        }
        .worker-conn-label.online  { color: #3fb950; background: rgba(63,185,80,0.12); }
        .worker-conn-label.stale   { color: #d29922; background: rgba(210,153,34,0.12); }
        .worker-conn-label.offline { color: #f85149; background: rgba(248,81,73,0.12); }
        .worker-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.25rem 0.75rem;
            font-size: 0.78rem;
        }
        .worker-detail {
            display: flex;
            justify-content: space-between;
        }
        .worker-detail .dk { color: #8b949e; }
        .worker-detail .dv { color: #c9d1d9; font-weight: 500; }
        .worker-detail .dv.outdated { color: #f0883e; }
        .worker-detail .dv.current  { color: #3fb950; }

        /* ── Collection Tiers ─────────────────────────────────── */
        .tier-list { display: flex; flex-direction: column; gap: 0.6rem; }
        .tier-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.6rem 0.85rem;
        }
        .tier-badge {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.15rem 0.45rem;
            border-radius: 4px;
            text-transform: uppercase;
            min-width: 50px;
            text-align: center;
            flex-shrink: 0;
        }
        .tier-badge.t0 { background: #1f6feb; color: #fff; }
        .tier-badge.t1 { background: #8957e5; color: #fff; }
        .tier-badge.t2 { background: #388bfd; color: #fff; }
        .tier-info { flex: 1; }
        .tier-name {
            font-size: 0.82rem;
            font-weight: 600;
            color: #f0f6fc;
        }
        .tier-desc {
            font-size: 0.7rem;
            color: #8b949e;
        }
        .tier-status {
            font-size: 0.68rem;
            font-weight: 600;
            padding: 0.12rem 0.5rem;
            border-radius: 10px;
            text-transform: uppercase;
            flex-shrink: 0;
        }
        .tier-status.enabled  { color: #3fb950; background: rgba(63,185,80,0.12); }
        .tier-status.disabled { color: #8b949e; background: rgba(139,148,158,0.12); }
        .tier-status.always   { color: #58a6ff; background: rgba(88,166,255,0.12); }

        /* ── Log Stream ───────────────────────────────────────── */

        /* ── Tab Tracker ──────────────────────────────────────── */
        .tab-tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 0.6rem;
        }
        .tab-chip {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.55rem 0.75rem;
            font-size: 0.78rem;
            position: relative;
            overflow: hidden;
        }
        .tab-chip::before {
            content: "";
            position: absolute;
            top: 0; left: 0; bottom: 0;
            width: 3px;
        }
        .tab-chip.s-pending::before       { background: #8b949e; }
        .tab-chip.s-navigating::before    { background: #58a6ff; }
        .tab-chip.s-detail_wait::before   { background: #58a6ff; }
        .tab-chip.s-scanning::before      { background: #d2a8ff; }
        .tab-chip.s-null_clicked::before  { background: #f0883e; }
        .tab-chip.s-converting::before    { background: #f0883e; }
        .tab-chip.s-ready::before         { background: #3fb950; }
        .tab-chip.s-add_clicked::before   { background: #3fb950; }
        .tab-chip.s-confirming::before    { background: #3fb950; }
        .tab-chip.s-verifying::before     { background: #3fb950; }
        .tab-chip.s-done::before          { background: #3fb950; }
        .tab-chip.s-error::before         { background: #f85149; }
        .tab-chip.s-blacklisted::before   { background: #6e40c9; }
        .tab-chip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }
        .tab-chip-id {
            font-weight: 600;
            font-family: "Cascadia Code", monospace;
            font-size: 0.75rem;
            color: #f0f6fc;
        }
        .tab-chip-status {
            font-size: 0.62rem;
            font-weight: 600;
            padding: 0.1rem 0.35rem;
            border-radius: 3px;
            text-transform: uppercase;
        }
        .tab-chip-status.s-pending       { color: #8b949e; background: rgba(139,148,158,0.15); }
        .tab-chip-status.s-navigating    { color: #58a6ff; background: rgba(88,166,255,0.15); }
        .tab-chip-status.s-detail_wait   { color: #58a6ff; background: rgba(88,166,255,0.15); }
        .tab-chip-status.s-scanning      { color: #d2a8ff; background: rgba(210,168,255,0.15); }
        .tab-chip-status.s-null_clicked  { color: #f0883e; background: rgba(240,136,62,0.15); }
        .tab-chip-status.s-converting    { color: #f0883e; background: rgba(240,136,62,0.15); }
        .tab-chip-status.s-ready         { color: #3fb950; background: rgba(63,185,80,0.15); }
        .tab-chip-status.s-add_clicked   { color: #3fb950; background: rgba(63,185,80,0.15); }
        .tab-chip-status.s-confirming    { color: #3fb950; background: rgba(63,185,80,0.15); }
        .tab-chip-status.s-verifying     { color: #3fb950; background: rgba(63,185,80,0.15); }
        .tab-chip-status.s-done          { color: #3fb950; background: rgba(63,185,80,0.15); }
        .tab-chip-status.s-error         { color: #f85149; background: rgba(248,81,73,0.15); }
        .tab-chip-status.s-blacklisted   { color: #6e40c9; background: rgba(110,64,201,0.15); }
        .tab-chip-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.15rem 0.5rem;
            font-size: 0.7rem;
            color: #8b949e;
        }
        .tab-chip-meta .val { color: #c9d1d9; }
        .tab-chip-error {
            margin-top: 0.25rem;
            font-size: 0.68rem;
            color: #f85149;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .tab-no-data {
            color: #8b949e;
            font-size: 0.82rem;
            padding: 0.5rem 0;
        }
        .log-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .log-controls select, .log-controls button {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .log-controls button:hover { background: #30363d; }
        .log-controls .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .log-controls .status-dot.connected { background: #3fb950; }
        .log-controls .status-dot.disconnected { background: #f85149; }

        #log-container {
            background: #0d1117;
            border: 1px solid #21262d;
            border-radius: 4px;
            height: 400px;
            overflow-y: auto;
            font-family: "Cascadia Code", "Fira Code", "Consolas", monospace;
            font-size: 0.78rem;
            padding: 0.5rem;
        }
        .log-entry {
            padding: 1px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .log-ts { color: #484f58; }
        .log-worker { color: #a5d6ff; }
        .log-level-DEBUG { color: #8b949e; }
        .log-level-INFO { color: #c9d1d9; }
        .log-level-WARNING { color: #d29922; }
        .log-level-ERROR { color: #f85149; }
        .log-level-CRITICAL { color: #ff7b72; font-weight: 700; }

        /* ── Code Manifest Table ──────────────────────────────── */
        .manifest-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.82rem;
        }
        .manifest-table th {
            text-align: left;
            color: #8b949e;
            border-bottom: 1px solid #30363d;
            padding: 0.3rem 0.5rem;
            font-weight: 600;
        }
        .manifest-table td {
            padding: 0.3rem 0.5rem;
            border-bottom: 1px solid #21262d;
        }
        .manifest-table td.hash {
            font-family: "Cascadia Code", monospace;
            font-size: 0.72rem;
            color: #8b949e;
        }

        /* ── Diagnostics Gallery ──────────────────────────────── */
        .diag-refresh {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }
        .diag-list {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.82rem;
        }
        .diag-item {
            padding: 0.2rem 0;
            border-bottom: 1px solid #21262d;
        }
        .diag-item .worker-tag {
            color: #a5d6ff;
            margin-right: 0.5rem;
        }

        /* ── Coordination Detail Table ─────────────────────────── */
        .coord-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.78rem;
        }
        .coord-table th {
            text-align: left;
            color: #8b949e;
            font-weight: 600;
            border-bottom: 1px solid #30363d;
            padding: 0.35rem 0.5rem;
        }
        .coord-table td {
            padding: 0.3rem 0.5rem;
            border-bottom: 1px solid #21262d;
        }
        .coord-table td.url-cell {
            font-family: "Cascadia Code", monospace;
            font-size: 0.72rem;
            color: #c9d1d9;
            max-width: 320px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .coord-table td.worker-cell {
            color: #a5d6ff;
            font-size: 0.75rem;
        }
        .coord-status-pill {
            display: inline-block;
            font-size: 0.62rem;
            font-weight: 600;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            text-transform: uppercase;
        }
        .coord-status-pill.s-held   { color: #f0883e; background: rgba(240,136,62,0.12); }
        .coord-status-pill.s-done   { color: #3fb950; background: rgba(63,185,80,0.12); }
        .coord-status-pill.s-failed { color: #f85149; background: rgba(248,81,73,0.12); }
        .coord-scroll {
            max-height: 260px;
            overflow-y: auto;
        }
        .coord-worker-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .coord-worker-chip {
            display: flex;
            align-items: center;
            gap: 0.45rem;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.35rem 0.7rem;
            font-size: 0.75rem;
        }
        .coord-worker-chip .cw-name {
            color: #a5d6ff;
            font-weight: 600;
        }
        .coord-worker-chip .cw-counts {
            display: flex;
            gap: 0.4rem;
            font-size: 0.68rem;
        }
        .coord-worker-chip .cw-held   { color: #f0883e; }
        .coord-worker-chip .cw-done   { color: #3fb950; }
        .coord-worker-chip .cw-failed { color: #f85149; }
        .coord-filter-row {
            display: flex;
            gap: 0.4rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        .coord-filter-btn {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 0.2rem 0.55rem;
            font-size: 0.72rem;
            cursor: pointer;
            transition: background 0.15s;
        }
        .coord-filter-btn:hover { background: #30363d; }
        .coord-filter-btn.active { border-color: #58a6ff; color: #58a6ff; }

        /* ── Footer ───────────────────────────────────────────── */
        .footer {
            text-align: center;
            color: #484f58;
            font-size: 0.7rem;
            margin-top: 1.5rem;
            padding-top: 0.75rem;
            border-top: 1px solid #21262d;
        }

        /* ── Responsive ───────────────────────────────────────── */
        @media (max-width: 900px) {
            .stat-row { grid-template-columns: repeat(2, 1fr); }
            .grid { grid-template-columns: 1fr; }
            .grid-3 { grid-template-columns: 1fr; }
            body { padding: 0.75rem 1rem; }
        }
        @media (max-width: 500px) {
            .stat-row { grid-template-columns: 1fr 1fr; }
            .header { flex-direction: column; gap: 0.5rem; align-items: flex-start; }
            .header-right { flex-wrap: wrap; }
        }
    </style>
</head>
<body>

    <!-- ── Header ──────────────────────────────────────────────── -->
    <div class="header">
        <div class="header-left">
            <h1>Roboflow Automation Dashboard</h1>
        </div>
        <div class="header-right">
            <span class="version-badge" id="version-badge">MANIFEST v{{ code_version }}</span>
            <span class="uptime" id="uptime" data-seconds="{{ uptime }}">Uptime: {{ uptime }}s</span>
        </div>
    </div>

    <!-- ── Stat Cards ──────────────────────────────────────────── -->
    <div class="stat-row" id="stat-row">
        <div class="stat-card held">
            <div class="value" id="stat-held">{{ summary.get('held', 0) }}</div>
            <div class="label">Held (In Progress)</div>
        </div>
        <div class="stat-card done">
            <div class="value" id="stat-done">{{ summary.get('done', 0) }}</div>
            <div class="label">Done</div>
        </div>
        <div class="stat-card failed">
            <div class="value" id="stat-failed">{{ summary.get('failed', 0) }}</div>
            <div class="label">Failed</div>
        </div>
        <div class="stat-card total">
            <div class="value" id="stat-total">{{ total_urls }}</div>
            <div class="label">Total Tracked</div>
        </div>
    </div>

    <!-- ── Actions Row ─────────────────────────────────────────── -->
    <div class="actions-row">
        <span class="actions-label">Actions:</span>
        <button id="btn-reset-blacklist" class="btn-action danger">
            ✕ Reset Blacklisted URLs
        </button>
    </div>

    <!-- ── Progress Bar ────────────────────────────────────────── -->
    <div class="progress-section" id="progress-section">
        {% set total = summary.get('held', 0) + summary.get('done', 0) + summary.get('failed', 0) %}
        {% set pct_done = (summary.get('done', 0) * 100 / total)|round(1) if total > 0 else 0 %}
        {% set pct_held = (summary.get('held', 0) * 100 / total)|round(1) if total > 0 else 0 %}
        {% set pct_failed = (summary.get('failed', 0) * 100 / total)|round(1) if total > 0 else 0 %}
        <div class="progress-header">
            <span class="label">Completion Progress</span>
            <span class="pct" id="progress-pct">{{ pct_done }}%</span>
        </div>
        <div class="progress-bar-outer">
            <div class="progress-bar-done" id="bar-done" style="width:{{ pct_done }}%"></div>
            <div class="progress-bar-held" id="bar-held" style="width:{{ pct_held }}%"></div>
            <div class="progress-bar-failed" id="bar-failed" style="width:{{ pct_failed }}%"></div>
        </div>
        <div class="progress-legend">
            <span class="leg-done">Done {{ pct_done }}%</span>
            <span class="leg-held">Held {{ pct_held }}%</span>
            <span class="leg-failed">Failed {{ pct_failed }}%</span>
        </div>
    </div>

    <!-- ── Middle Grid: Workers + Collection Tiers ─────────────── -->
    <div class="grid">
        <div class="card">
            <h2>Workers <span class="badge-sm" id="worker-count">{{ workers|length }}</span></h2>
            <div class="worker-grid" id="worker-list">
                {% for wid, info in workers.items() %}
                <div class="worker-card">
                    <div class="worker-card-header">
                        <span class="worker-dot {{ info.connection }}"></span>
                        <span class="worker-name">{{ wid }}</span>
                        <span class="worker-conn-label {{ info.connection }}">{{ info.connection }}</span>
                    </div>
                    <div class="worker-details">
                        <div class="worker-detail">
                            <span class="dk">Status</span>
                            <span class="dv">{{ info.get('status', '?') }}</span>
                        </div>
                        <div class="worker-detail">
                            <span class="dk">Last Seen</span>
                            <span class="dv">{{ info.last_seen_ago }}s ago</span>
                        </div>
                        <div class="worker-detail">
                            <span class="dk">Code Ver</span>
                            <span class="dv {% if info.get('code_version', 0) < code_version %}outdated{% else %}current{% endif %}">
                                v{{ info.get('code_version', '?') }}{% if info.get('code_version', 0) < code_version %} &#9888;{% endif %}
                            </span>
                        </div>
                        <div class="worker-detail">
                            <span class="dk">Strategy</span>
                            <span class="dv">{{ info.get('strategy', '&mdash;') }}</span>
                        </div>
                    </div>
                </div>
                {% else %}
                <span style="color:#8b949e;">No workers connected yet</span>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h2>Collection Tiers</h2>
            <div class="tier-list">
                <div class="tier-item">
                    <span class="tier-badge t0">Tier 0</span>
                    <div class="tier-info">
                        <div class="tier-name">Firestore Fetch Intercept</div>
                        <div class="tier-desc">JS monkey-patch captures gRPC subscription IDs</div>
                    </div>
                    <span class="tier-status disabled" id="tier0-status">Disabled</span>
                </div>
                <div class="tier-item">
                    <span class="tier-badge t1">Tier 1</span>
                    <div class="tier-info">
                        <div class="tier-name">React Fiber DOM Scan</div>
                        <div class="tier-desc">Traverses virtualised list via Fiber tree</div>
                    </div>
                    <span class="tier-status enabled" id="tier1-status">Enabled</span>
                </div>
                <div class="tier-item">
                    <span class="tier-badge t2">Tier 2</span>
                    <div class="tier-info">
                        <div class="tier-name">Click-per-Card Fallback</div>
                        <div class="tier-desc">Clicks each card and reads URL from browser</div>
                    </div>
                    <span class="tier-status always">Always On</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ── Tab Tracker (Round-Robin Pipeline) ─────────────────── -->
    <div class="card" style="margin-bottom:1.25rem;">
        <h2>Tab Pipeline Tracker
            <span class="badge-sm" id="tab-count">0 tabs</span>
        </h2>
        <div class="tab-tracker-grid" id="tab-tracker">
            <div class="tab-no-data">Waiting for worker heartbeat with tab data&hellip;</div>
        </div>
    </div>

    <!-- ── Live Log Stream ─────────────────────────────────────── -->
    <div class="card" style="margin-bottom:1.25rem;">
        <h2>Live Log Stream
            <span class="badge-sm" id="log-count">0 entries</span>
        </h2>
        <div class="log-controls">
            <span class="status-dot disconnected" id="sse-dot"></span>
            <span id="sse-status" style="font-size:0.8rem; color:#8b949e;">Connecting&hellip;</span>
            <select id="log-worker-filter" title="Filter by worker">
                <option value="">All workers</option>
                {% for wid in workers.keys() %}
                <option value="{{ wid }}">{{ wid }}</option>
                {% endfor %}
            </select>
            <select id="log-level-filter" title="Filter by level">
                <option value="">All levels</option>
                <option value="DEBUG">DEBUG</option>
                <option value="INFO">INFO</option>
                <option value="WARNING">WARNING</option>
                <option value="ERROR">ERROR</option>
                <option value="CRITICAL">CRITICAL</option>
            </select>
            <button id="btn-clear" title="Clear log view">Clear</button>
            <label style="font-size:0.8rem; color:#8b949e; margin-left:auto;">
                <input type="checkbox" id="auto-scroll" checked> Auto-scroll
            </label>
        </div>
        <div id="log-container"></div>
    </div>

    <!-- ── Coordination Breakdown ──────────────────────────────── -->
    <div class="card" style="margin-bottom:1.25rem;">
        <h2>Coordination Breakdown
            <span class="badge-sm" id="coord-url-count">0 URLs</span>
        </h2>
        <div class="coord-worker-summary" id="coord-worker-summary">
            <span style="color:#8b949e; font-size:0.78rem;">Loading snapshot&hellip;</span>
        </div>
        <div class="coord-filter-row">
            <button class="coord-filter-btn active" data-filter="all">All</button>
            <button class="coord-filter-btn" data-filter="held">Held</button>
            <button class="coord-filter-btn" data-filter="done">Done</button>
            <button class="coord-filter-btn" data-filter="failed">Failed</button>
        </div>
        <div class="coord-scroll">
            <table class="coord-table">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>URL</th>
                        <th>Worker</th>
                    </tr>
                </thead>
                <tbody id="coord-table-body">
                    <tr><td colspan="3" style="color:#8b949e;">Waiting for data&hellip;</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ── Bottom Grid: Diagnostics + Code ─────────────────────── -->
    <div class="grid">
        <div class="card">
            <h2>Diagnostics
                <button id="btn-diag-refresh" style="background:#21262d;color:#c9d1d9;border:1px solid #30363d;border-radius:4px;padding:0.15rem 0.5rem;font-size:0.7rem;cursor:pointer;">Refresh</button>
            </h2>
            <div class="diag-list" id="diag-list">
                <span style="color:#8b949e;">Click Refresh to load</span>
            </div>
        </div>

        <div class="card">
            <h2>Code Manifest
                <span class="badge-sm" id="manifest-version">v{{ code_version }}</span>
            </h2>
            <table class="manifest-table">
                <thead>
                    <tr>
                        <th>File</th>
                        <th>SHA-256 (short)</th>
                    </tr>
                </thead>
                <tbody id="manifest-body">
                    {% for item in manifest %}
                    <tr>
                        <td>{{ item.path }}</td>
                        <td class="hash">{{ item.sha256[:12] }}&hellip;</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2" style="color:#8b949e;">No manifest available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        Roboflow Automation &mdash; Remote Monitoring Dashboard &mdash; Auto-refreshes every 10s
    </div>

    <!-- ── JavaScript ──────────────────────────────────────────── -->
    <script>
    (function() {
        "use strict";

        // ── DOM refs ────────────────────────────────────────────
        var logContainer   = document.getElementById("log-container");
        var sseDot         = document.getElementById("sse-dot");
        var sseStatus      = document.getElementById("sse-status");
        var workerFilter   = document.getElementById("log-worker-filter");
        var levelFilter    = document.getElementById("log-level-filter");
        var btnClear       = document.getElementById("btn-clear");
        var autoScroll     = document.getElementById("auto-scroll");
        var btnDiagRefresh = document.getElementById("btn-diag-refresh");
        var diagList       = document.getElementById("diag-list");
        var logCountBadge  = document.getElementById("log-count");

        var LEVEL_ORDER = { DEBUG: 0, INFO: 1, WARNING: 2, ERROR: 3, CRITICAL: 4 };
        var totalLogEntries = 0;
        var serverCodeVersion = {{ code_version }};

        // ── Helpers ─────────────────────────────────────────────
        function escapeHtml(text) {
            var d = document.createElement("div");
            d.appendChild(document.createTextNode(String(text)));
            return d.innerHTML;
        }

        function fmtDuration(sec) {
            if (sec < 60) return sec + "s ago";
            if (sec < 3600) return Math.floor(sec / 60) + "m ago";
            return Math.floor(sec / 3600) + "h " + Math.floor((sec % 3600) / 60) + "m ago";
        }

        // ── Render a single log entry ───────────────────────────
        function renderEntry(entry) {
            var wf = workerFilter.value;
            var lf = levelFilter.value;
            if (wf && entry.worker !== wf) return null;
            if (lf && (LEVEL_ORDER[entry.level] || 0) < (LEVEL_ORDER[lf] || 0)) return null;

            var div = document.createElement("div");
            div.className = "log-entry";
            div.innerHTML =
                '<span class="log-ts">' + escapeHtml(entry.ts || "?") + "</span> " +
                '<span class="log-worker">[' + escapeHtml(entry.worker || "?") + "]</span> " +
                '<span class="log-level-' + escapeHtml(entry.level || "INFO") + '">' +
                escapeHtml(entry.level || "INFO") + "</span> " +
                escapeHtml(entry.message || "");
            return div;
        }

        function appendEntry(entry) {
            var el = renderEntry(entry);
            if (!el) return;
            logContainer.appendChild(el);
            totalLogEntries++;
            while (logContainer.children.length > 2000) {
                logContainer.removeChild(logContainer.firstChild);
            }
            if (autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            logCountBadge.textContent = logContainer.children.length + " entries";
        }

        // ── Load history ────────────────────────────────────────
        function loadHistory() {
            fetch("/logs/history?n=200")
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    logContainer.innerHTML = "";
                    (data.entries || []).forEach(appendEntry);
                })
                .catch(function() {});
        }

        // ── SSE connection ──────────────────────────────────────
        var evtSource = null;

        function connectSSE() {
            if (evtSource) { evtSource.close(); }
            var url = "/logs/stream";
            var wf = workerFilter.value;
            if (wf) url += "?worker=" + encodeURIComponent(wf);

            evtSource = new EventSource(url);

            evtSource.onopen = function() {
                sseDot.className = "status-dot connected";
                sseStatus.textContent = "Connected";
            };

            evtSource.addEventListener("log", function(e) {
                try { appendEntry(JSON.parse(e.data)); } catch(err) {}
            });

            evtSource.onerror = function() {
                sseDot.className = "status-dot disconnected";
                sseStatus.textContent = "Reconnecting\u2026";
            };
        }

        // ── Diagnostics loader ──────────────────────────────────
        function loadDiagnostics() {
            diagList.innerHTML = '<span style="color:#8b949e;">Loading\u2026</span>';
            fetch("/diagnostics")
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    diagList.innerHTML = "";
                    var files = data || {};
                    var hasAny = false;
                    Object.keys(files).forEach(function(worker) {
                        (files[worker] || []).forEach(function(fname) {
                            hasAny = true;
                            var div = document.createElement("div");
                            div.className = "diag-item";
                            div.innerHTML =
                                '<span class="worker-tag">' + escapeHtml(worker) + "</span>" +
                                '<a href="/diagnostics/' + encodeURIComponent(worker) + "/" +
                                encodeURIComponent(fname) + '" target="_blank">' +
                                escapeHtml(fname) + "</a>";
                            diagList.appendChild(div);
                        });
                    });
                    if (!hasAny) {
                        diagList.innerHTML = '<span style="color:#8b949e;">No diagnostics uploaded yet</span>';
                    }
                })
                .catch(function() {
                    diagList.innerHTML = '<span style="color:#f85149;">Failed to load diagnostics</span>';
                });
        }

        // ── Summary + Progress auto-refresh ─────────────────────
        function refreshSummary() {
            fetch("/summary")
                .then(function(r) { return r.json(); })
                .then(function(s) {
                    var held = s.held || 0;
                    var done = s.done || 0;
                    var failed = s.failed || 0;
                    var total = held + done + failed;

                    document.getElementById("stat-held").textContent = held;
                    document.getElementById("stat-done").textContent = done;
                    document.getElementById("stat-failed").textContent = failed;
                    document.getElementById("stat-total").textContent = total;

                    // Progress bar
                    var pctDone = total > 0 ? (done / total * 100).toFixed(1) : 0;
                    var pctHeld = total > 0 ? (held / total * 100).toFixed(1) : 0;
                    var pctFailed = total > 0 ? (failed / total * 100).toFixed(1) : 0;

                    document.getElementById("progress-pct").textContent = pctDone + "%";
                    document.getElementById("bar-done").style.width = pctDone + "%";
                    document.getElementById("bar-held").style.width = pctHeld + "%";
                    document.getElementById("bar-failed").style.width = pctFailed + "%";

                    // Legend
                    var legend = document.querySelector(".progress-legend");
                    if (legend) {
                        legend.innerHTML =
                            '<span class="leg-done">Done ' + pctDone + '%</span>' +
                            '<span class="leg-held">Held ' + pctHeld + '%</span>' +
                            '<span class="leg-failed">Failed ' + pctFailed + '%</span>';
                    }
                })
                .catch(function() {});
        }

        // ── Worker refresh ──────────────────────────────────────
        function refreshWorkers() {
            fetch("/workers")
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    var list = document.getElementById("worker-list");
                    var countBadge = document.getElementById("worker-count");
                    list.innerHTML = "";
                    var workers = data || {};
                    var keys = Object.keys(workers);
                    countBadge.textContent = keys.length;

                    if (!keys.length) {
                        list.innerHTML = '<span style="color:#8b949e;">No workers connected yet</span>';
                        return;
                    }

                    keys.forEach(function(wid) {
                        var info = workers[wid];
                        var conn = info.connection || "offline";
                        var cv = info.code_version != null ? info.code_version : "?";
                        var isOutdated = (typeof cv === "number") && cv < serverCodeVersion;
                        var cvClass = isOutdated ? "outdated" : "current";
                        var cvWarn = isOutdated ? " &#9888;" : "";

                        // Per-worker coordination counts from latest snapshot
                        var wHeld = 0, wDone = 0, wFailed = 0;
                        if (lastSnapshot) {
                            ["held", "done", "failed"].forEach(function(st) {
                                var urls = lastSnapshot[st] || {};
                                Object.keys(urls).forEach(function(u) {
                                    var w = urls[u].worker || urls[u].holder || "";
                                    if (w === wid) {
                                        if (st === "held") wHeld++;
                                        else if (st === "done") wDone++;
                                        else wFailed++;
                                    }
                                });
                            });
                        }

                        var card = document.createElement("div");
                        card.className = "worker-card";
                        card.innerHTML =
                            '<div class="worker-card-header">' +
                                '<span class="worker-dot ' + escapeHtml(conn) + '"></span>' +
                                '<span class="worker-name">' + escapeHtml(wid) + '</span>' +
                                '<span class="worker-conn-label ' + escapeHtml(conn) + '">' + escapeHtml(conn) + '</span>' +
                            '</div>' +
                            '<div class="worker-details">' +
                                '<div class="worker-detail"><span class="dk">Status</span><span class="dv">' + escapeHtml(info.status || "?") + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Last Seen</span><span class="dv">' + fmtDuration(info.last_seen_ago || 0) + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Code Ver</span><span class="dv ' + cvClass + '">v' + escapeHtml(String(cv)) + cvWarn + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Strategy</span><span class="dv">' + escapeHtml(info.strategy || "\u2014") + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Held</span><span class="dv" style="color:#f0883e">' + wHeld + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Done</span><span class="dv" style="color:#3fb950">' + wDone + '</span></div>' +
                                '<div class="worker-detail"><span class="dk">Failed</span><span class="dv" style="color:#f85149">' + wFailed + '</span></div>' +
                            '</div>';
                        list.appendChild(card);
                    });

                    // Update worker filter dropdown if new workers appear
                    var currentOpts = {};
                    for (var i = 0; i < workerFilter.options.length; i++) {
                        currentOpts[workerFilter.options[i].value] = true;
                    }
                    keys.forEach(function(wid) {
                        if (!currentOpts[wid]) {
                            var opt = document.createElement("option");
                            opt.value = wid;
                            opt.textContent = wid;
                            workerFilter.appendChild(opt);
                        }
                    });
                })
                .catch(function() {});
        }

        // ── Manifest refresh ────────────────────────────────────
        function refreshManifest() {
            fetch("/code/manifest")
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    serverCodeVersion = data.version || 0;
                    document.getElementById("version-badge").textContent = "MANIFEST v" + serverCodeVersion;
                    document.getElementById("manifest-version").textContent = "v" + serverCodeVersion;

                    var files = data.files || [];
                    var tbody = document.getElementById("manifest-body");
                    if (!files.length) {
                        tbody.innerHTML = '<tr><td colspan="2" style="color:#8b949e;">No manifest available</td></tr>';
                        return;
                    }
                    tbody.innerHTML = "";
                    files.forEach(function(item) {
                        var tr = document.createElement("tr");
                        tr.innerHTML =
                            '<td>' + escapeHtml(item.path) + '</td>' +
                            '<td class="hash">' + escapeHtml((item.sha256 || "").substring(0, 12)) + '&hellip;</td>';
                        tbody.appendChild(tr);
                    });
                })
                .catch(function() {});
        }

        // ── Tab Tracker refresh ─────────────────────────────────
        function refreshTabTracker() {
            // Tab states come from worker heartbeat data (via /workers endpoint).
            // Each worker may include a "tabs" array in its heartbeat.
            fetch("/workers")
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    var container = document.getElementById("tab-tracker");
                    var countBadge = document.getElementById("tab-count");
                    var allTabs = [];

                    Object.keys(data || {}).forEach(function(wid) {
                        var info = data[wid];
                        if (info.tabs && Array.isArray(info.tabs)) {
                            info.tabs.forEach(function(t) {
                                t._worker = wid;
                                allTabs.push(t);
                            });
                        }
                    });

                    countBadge.textContent = allTabs.length + " tabs";

                    if (!allTabs.length) {
                        container.innerHTML = '<div class="tab-no-data">Waiting for worker heartbeat with tab data&hellip;</div>';
                        return;
                    }

                    container.innerHTML = "";
                    allTabs.forEach(function(t) {
                        var st = t.status || "pending";
                        var chip = document.createElement("div");
                        chip.className = "tab-chip s-" + st;
                        var errorLine = "";
                        if (t.error_msg) {
                            errorLine = '<div class="tab-chip-error" title="' + escapeHtml(t.error_msg) + '">' + escapeHtml(t.error_msg) + '</div>';
                        }
                        chip.innerHTML =
                            '<div class="tab-chip-header">' +
                                '<span class="tab-chip-id">' + escapeHtml(t.short_id || "?") + '</span>' +
                                '<span class="tab-chip-status s-' + st + '">' + escapeHtml(st) + '</span>' +
                            '</div>' +
                            '<div class="tab-chip-meta">' +
                                '<span>In state: <span class="val">' + (t.time_in_state || 0).toFixed(0) + 's</span></span>' +
                                '<span>Ticks: <span class="val">' + (t.ticks || 0) + '</span></span>' +
                                '<span>Images: <span class="val">' + (t.image_count || 0) + '</span></span>' +
                                '<span>Errors: <span class="val">' + (t.errors || 0) + '</span></span>' +
                                '<span>Type: <span class="val">' + escapeHtml(t.card_type || "\u2014") + '</span></span>' +
                                '<span>Worker: <span class="val">' + escapeHtml(t._worker || "?") + '</span></span>' +
                            '</div>' +
                            errorLine;
                        container.appendChild(chip);
                    });
                })
                .catch(function() {});
        }

        // ── Event bindings ──────────────────────────────────────
        btnClear.addEventListener("click", function() {
            logContainer.innerHTML = "";
            logCountBadge.textContent = "0 entries";
        });

        document.getElementById("btn-reset-blacklist").addEventListener("click", function() {
            var failedCount = parseInt(document.getElementById("stat-failed").textContent, 10) || 0;
            if (!confirm("Reset " + failedCount + " blacklisted/failed URL(s)?\n\nThey will be re-eligible for claiming on the next worker cycle.\nDone and held entries will not be affected.")) return;
            fetch("/reset_blacklist", { method: "POST" })
                .then(function(r) { return r.json(); })
                .then(function(d) {
                    alert("Cleared " + (d.cleared || 0) + " failed URL(s). Workers can now re-claim them.");
                    refreshSummary();
                })
                .catch(function() { alert("Request failed — is the server reachable?"); });
        });

        workerFilter.addEventListener("change", function() {
            loadHistory();
            connectSSE();
        });

        levelFilter.addEventListener("change", function() {
            loadHistory();
        });

        btnDiagRefresh.addEventListener("click", loadDiagnostics);

        // ── Uptime ticker ───────────────────────────────────────
        var uptimeEl = document.getElementById("uptime");
        var startUptime = parseInt(uptimeEl.getAttribute("data-seconds"), 10) || 0;
        var startTs = Date.now();

        setInterval(function() {
            var elapsed = Math.floor((Date.now() - startTs) / 1000);
            var total = startUptime + elapsed;
            var h = Math.floor(total / 3600);
            var m = Math.floor((total % 3600) / 60);
            var s = total % 60;
            uptimeEl.textContent = "Uptime: " + h + "h " + m + "m " + s + "s";
        }, 1000);

        // ── Coordination Snapshot refresh ────────────────────────
        var coordSnapshotFilter = "all";
        var lastSnapshot = null;

        // Wire up filter buttons
        document.querySelectorAll(".coord-filter-btn").forEach(function(btn) {
            btn.addEventListener("click", function() {
                document.querySelectorAll(".coord-filter-btn").forEach(function(b) { b.classList.remove("active"); });
                btn.classList.add("active");
                coordSnapshotFilter = btn.getAttribute("data-filter");
                renderSnapshotTable(lastSnapshot);
            });
        });

        function renderSnapshotTable(snapshot) {
            if (!snapshot) return;
            var tbody = document.getElementById("coord-table-body");
            var rows = [];

            ["held", "done", "failed"].forEach(function(status) {
                var urls = snapshot[status] || {};
                Object.keys(urls).forEach(function(url) {
                    rows.push({
                        status: status,
                        url: url,
                        worker: urls[url].worker || urls[url].holder || "\u2014"
                    });
                });
            });

            // Apply filter
            var filtered = coordSnapshotFilter === "all"
                ? rows
                : rows.filter(function(r) { return r.status === coordSnapshotFilter; });

            document.getElementById("coord-url-count").textContent = rows.length + " URLs";

            if (!filtered.length) {
                tbody.innerHTML = '<tr><td colspan="3" style="color:#8b949e;">'
                    + (rows.length ? 'No URLs with status \u201c' + coordSnapshotFilter + '\u201d'
                                   : 'No tracked URLs yet')
                    + '</td></tr>';
                return;
            }

            // Sort: held first, then done, then failed
            var order = { held: 0, done: 1, failed: 2 };
            filtered.sort(function(a, b) { return (order[a.status] || 0) - (order[b.status] || 0); });

            // Limit display to 200 rows for performance
            var shown = filtered.slice(0, 200);
            tbody.innerHTML = "";
            shown.forEach(function(r) {
                var tr = document.createElement("tr");
                // Shorten URL for display: show last ~60 chars
                var shortUrl = r.url.length > 60 ? "\u2026" + r.url.slice(-60) : r.url;
                tr.innerHTML =
                    '<td><span class="coord-status-pill s-' + r.status + '">' + escapeHtml(r.status) + '</span></td>' +
                    '<td class="url-cell" title="' + escapeHtml(r.url) + '">' + escapeHtml(shortUrl) + '</td>' +
                    '<td class="worker-cell">' + escapeHtml(r.worker) + '</td>';
                tbody.appendChild(tr);
            });
            if (filtered.length > 200) {
                var extra = document.createElement("tr");
                extra.innerHTML = '<td colspan="3" style="color:#8b949e;font-style:italic;">'
                    + '\u2026 and ' + (filtered.length - 200) + ' more URLs</td>';
                tbody.appendChild(extra);
            }
        }

        function refreshSnapshot() {
            fetch("/snapshot")
                .then(function(r) { return r.json(); })
                .then(function(snapshot) {
                    lastSnapshot = snapshot;

                    // Per-worker summary chips
                    var workerStats = {};
                    ["held", "done", "failed"].forEach(function(status) {
                        var urls = snapshot[status] || {};
                        Object.keys(urls).forEach(function(url) {
                            var w = urls[url].worker || urls[url].holder || "unknown";
                            if (!workerStats[w]) workerStats[w] = { held: 0, done: 0, failed: 0 };
                            workerStats[w][status]++;
                        });
                    });

                    var summaryDiv = document.getElementById("coord-worker-summary");
                    var wkeys = Object.keys(workerStats);
                    if (!wkeys.length) {
                        summaryDiv.innerHTML = '<span style="color:#8b949e;font-size:0.78rem;">No coordination data yet</span>';
                    } else {
                        summaryDiv.innerHTML = "";
                        wkeys.forEach(function(w) {
                            var s = workerStats[w];
                            var chip = document.createElement("div");
                            chip.className = "coord-worker-chip";
                            chip.innerHTML =
                                '<span class="cw-name">' + escapeHtml(w) + '</span>' +
                                '<span class="cw-counts">' +
                                    '<span class="cw-held" title="Held">\u25CF ' + s.held + '</span>' +
                                    '<span class="cw-done" title="Done">\u25CF ' + s.done + '</span>' +
                                    '<span class="cw-failed" title="Failed">\u25CF ' + s.failed + '</span>' +
                                '</span>';
                            summaryDiv.appendChild(chip);
                        });
                    }

                    renderSnapshotTable(snapshot);
                })
                .catch(function() {});
        }

        // ── Periodic refresh intervals ──────────────────────────
        setInterval(refreshSummary, 10000);     // Summary stats every 10s
        setInterval(refreshWorkers, 10000);     // Workers every 10s
        setInterval(refreshManifest, 30000);    // Manifest every 30s
        setInterval(refreshTabTracker, 10000);  // Tab tracker every 10s
        setInterval(refreshSnapshot, 15000);    // Coordination snapshot every 15s

        // ── Init ────────────────────────────────────────────────
        loadHistory();
        connectSSE();
        refreshSummary();
        refreshWorkers();
        refreshTabTracker();
        refreshSnapshot();
    })();
    </script>
</body>
</html>
